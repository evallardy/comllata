{% extends 'core/diseno/NiceShop/base.html' %}
{% load static %}
{% block content %}
<style>
    .product-list-scroll {
        max-height: 120px; /* Ajusta según diseño */
        overflow-y: auto;
        padding-right: 5px; /* Para scroll visible */
    }

    .product-item-small {
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
        padding: 2px 0;
    }

    .product-list-scroll::-webkit-scrollbar {
        width: 6px;
    }

    .product-list-scroll::-webkit-scrollbar-thumb {
        background-color: #ccc;
        border-radius: 3px;
    }

    .product-list-scroll::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
</style>
    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Taller</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="{% url 'muestraProductos' %}">Regresar</a></li>
            <li><a href="{% url 'home' %}">Inicio</a></li>
            <li class="current">Taller</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Best Sellers Section -->
    <section id="best-sellers" class="best-sellers section">
      <!-- Section Title -->
      <div class="container section-title" data-aos="fade-up">
        <h2>Taller {{ taller.razon_social }}</h2>
        <p>{{ detalle_llanta }}</p>
      </div><!-- End Section Title -->

      <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="row g-5">
          {% for producto in inventario %}
          <!-- Product 1 -->
          <div class="col-lg-3 col-md-6">
            <div class="product-item">
              <div class="product-image">
                <div class="product-badge"></div>
                <img src="{% static 'core/img/rin/r13.png' %}" alt="Product Image" class="img-fluid" loading="lazy">
                <a href="#" 
                  class="cart-btn" 
                  onclick="agregarCarrito('{{ producto.id }}'); return false;">
                  Agregar
                </a>
              </div>
              <div class="product-info">
                <div class="product-category">[ {{ producto.id }} ]{{ producto.descripcion }}</div>
                <div class="product-rating">
                  <div class="stars">
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star"></i>
                  </div>
                  <span class="rating-count">(24)</span>
                </div>
                <div class="product-list-scroll">
                    <div class="product-item-small">
                        <span>{{ producto.producto_clave }}</span>
                        <div class="product-price">${{ producto.precio|floatformat:2 }}</div>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <!-- End Product 1 -->
          {% endfor %}

        </div>

      </div>

    </section><!-- /Best Sellers Section -->
<script>
function agregarCarrito(pk) {
    llave = pk.replace(",","");
    fetch("{% url 'agregaCarrito' 0 %}".replace("0", llave), {
        method: "GET",
        headers: {
            "X-Requested-With": "XMLHttpRequest"
        }
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error("Error en la petición");
    })
    .then(data => {
      document.querySelector("#id_piezas").innerText = data.piezas;
      alert(data.message); // mostrar mensaje
    })
    .catch(error => {
        console.error("Error:", error);
        alert("Ocurrió un error.");
    });
}
</script>
{% endblock %}    