{% extends 'core/diseno/NiceShop/base.html' %}
{% load static %}
{% load carrito_filters %}
{% block content %}
  <main class="main">
  <script src="https://www.paypal.com/sdk/js?client-id=AbH3kReloqliHjc6WOggaPNsmJHWAqHt3sW88a-MS5JFP0BnwJM301HgHqADBsJdk8XIR5MgGueLO2xx&currency=MXN"></script>
    <!-- Page Title -->
    <div class="page-title light-background">
      <div class="container d-lg-flex justify-content-between align-items-center">
        <h1 class="mb-2 mb-lg-0">Orden de compra</h1>
        <nav class="breadcrumbs">
          <ol>
            <li><a href="{% url 'carrito' %}">Regresar</a></li>
            <li><a href="{% url 'home' %}">Inicio</a></li>
            <li class="current">Checkout</li>
          </ol>
        </nav>
      </div>
    </div><!-- End Page Title -->

    <!-- Checkout Section -->
    <section id="checkout" class="checkout section">

      <div class="container" data-aos="fade-up" data-aos-delay="100">

        <div class="row">
          <div class="col-lg-7">
            <!-- Checkout Form -->
            <div class="checkout-container" data-aos="fade-up">
              <form class="checkout-form">
                <!-- Customer Information -->
                <div class="checkout-section" id="customer-info">
                  <div class="section-header">
                    <div class="section-number">1</div>
                    <h3>Información del cliente</h3>
                  </div>
                  <div class="section-content">
                    <div class="row">
                      <div class="col-md-6 form-group">
                        <label for="first-name">Nombre</label>
                        <input type="text" name="first-name" class="form-control" id="first-name" placeholder="Nombre" required="">
                      </div>
                      <div class="col-md-6 form-group">
                        <label for="last-name">Apellidos</label>
                        <input type="text" name="last-name" class="form-control" id="last-name" placeholder="Apellidos" required="">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="email">Correo</label>
                      <input type="email" class="form-control" name="email" id="email" placeholder="Correo" required="">
                    </div>
                    <div class="form-group">
                      <label for="phone">Teléfono</label>
                      <input type="tel" class="form-control" name="phone" id="phone" placeholder="Teléfono" required="">
                    </div>
                  </div>
                </div>

                <!-- Shipping Address -->
                <div class="checkout-section" id="shipping-address">
                  <div class="section-header">
                    <div class="section-number">2</div>
                    <h3>Domicilio</h3>
                  </div>
                  <div class="section-content">
                    <div class="form-group">
                      <label for="address">Calle</label>
                      <input type="text" class="form-control" name="address" id="address" placeholder="Calle" required="">
                    </div>
                    <div class="form-group">
                      <label for="apartment">Numero exterior / interior</label>
                      <input type="text" class="form-control" name="apartment" id="apartment" placeholder="Numero exterior / interior">
                    </div>
                    <div class="row">
                      <div class="col-md-4 form-group">
                        <label for="city">Ciudad</label>
                        <input type="text" name="city" class="form-control" id="city" placeholder="Ciudad" required="">
                      </div>
                      <div class="col-md-4 form-group">
                        <label for="state">Estado</label>
                        <input type="text" name="state" class="form-control" id="state" placeholder="Estado" required="">
                      </div>
                      <div class="col-md-4 form-group">
                        <label for="zip">Código postal</label>
                        <input type="text" name="zip" class="form-control" id="zip" placeholder="Código postal" required="">
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="country">País</label>
                      <select class="form-select" id="country" name="country" required="">
                        <option value="">Selecciona país</option>
                        <option value="MX">México</option>
                        <option value="US">United States</option>
                      </select>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="save-address" name="save-address">
                      <label class="form-check-label" for="save-address">
                        Guardar dirección para futuras compras
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="billing-same" name="billing-same" checked="">
                      <label class="form-check-label" for="billing-same">
                        Domicilio es el mismo que el envio
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Payment Method -->
                <div class="checkout-section" id="payment-method">
                  <div class="section-header">
                    <div class="section-number">3</div>
                    <h3>Método de pago</h3>
                  </div>
                  <div class="section-content">
                    <div class="payment-options">
<!--
                      <div class="payment-option active">
                        <input type="radio" name="payment-method" id="credit-card" checked="">
                        <label for="credit-card">
                          <span class="payment-icon"><i class="bi bi-credit-card-2-front"></i></span>
                          <span class="payment-label">Credit / Debit Card</span>
                        </label>
                      </div>
-->                                            
                      <div class="payment-option">
                        <input type="radio" name="payment-method" id="paypal">
                        <label for="paypal">
                          <span class="payment-icon"><i class="bi bi-paypal"></i></span>
                          <span class="payment-label">PayPal</span>
                        </label>
                      </div>
<!--                     
                      <div class="payment-option">
                        <input type="radio" name="payment-method" id="apple-pay">
                        <label for="apple-pay">
                          <span class="payment-icon"><i class="bi bi-apple"></i></span>
                          <span class="payment-label">Apple Pay</span>
                        </label>
                      </div>
-->                                            
                    </div>
<!--
                    <div class="payment-details" id="credit-card-details">
                      <div class="form-group">
                        <label for="card-number">Card Number</label>
                        <div class="card-number-wrapper">
                          <input type="text" class="form-control" name="card-number" id="card-number" placeholder="1234 5678 9012 3456" required="">
                          <div class="card-icons">
                            <i class="bi bi-credit-card-2-front"></i>
                            <i class="bi bi-credit-card"></i>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6 form-group">
                          <label for="expiry">Expiration Date</label>
                          <input type="text" class="form-control" name="expiry" id="expiry" placeholder="MM/YY" required="">
                        </div>
                        <div class="col-md-6 form-group">
                          <label for="cvv">Security Code (CVV)</label>
                          <div class="cvv-wrapper">
                            <input type="text" class="form-control" name="cvv" id="cvv" placeholder="123" required="">
                            <span class="cvv-hint" data-bs-toggle="tooltip" data-bs-placement="top" title="3-digit code on the back of your card">
                              <i class="bi bi-question-circle"></i>
                            </span>
                          </div>
                        </div>
                      </div>
                      <div class="form-group">
                        <label for="card-name">Name on Card</label>
                        <input type="text" class="form-control" name="card-name" id="card-name" placeholder="John Doe" required="">
                      </div>
                    </div>

                    <div class="payment-details d-none" id="paypal-details">
                      <p class="payment-info">You will be redirected to PayPal to complete your purchase securely.</p>
                    </div>

                    <div class="payment-details d-none" id="apple-pay-details">
                      <p class="payment-info">You will be prompted to authorize payment with Apple Pay.</p>
                    </div>
-->                    
                  </div>
                </div>

                <!-- Order Review -->
                <div class="checkout-section" id="order-review">
                  <div class="section-header">
                    <div class="section-number">4</div>
                    <h3>Revisa &amp; Realiza el pedido</h3>
                  </div>
                  <div class="section-content">
                    <div class="form-check terms-check">
                      <input class="form-check-input" type="checkbox" id="terms" name="terms" required="">
                      <label class="form-check-label" for="terms">
                        Acepto <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">los Términos y Condiciones and Conditions</a> y <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">las Políticas de Privacidad</a>
                      </label>
                    </div>
                    <div class="success-message d-none">¡Tu pedido se ha realizado correctamente! Gracias por tu compra.</div>

                    <!-- PayPal: este div se usará para mostrar el botón -->
                    <div id="paypal-button-container"></div>

                    <div class="place-order-container">
                      <button id="paypal-btn" type="button" class="btn btn-primary place-order-btn">
                        <span class="btn-text">Realizar pedido</span>
                        <span class="btn-price">${{ carrito.total_general }}</span>
                      </button>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="col-lg-5">
            <!-- Order Summary -->
            <div class="order-summary" data-aos="fade-left" data-aos-delay="200">
              <div class="order-summary-header">
                <h3>Resumn de orden</h3>
                <span class="item-count">{{ carrito.piezas|default:0 }} Item{% if carrito.piezas|default:0 != 1 %}s{% endif %}</span>
              </div>
              {% for pk, renglon in carrito.items %}
              {% if pk|isdigit %}
              <div class="order-summary-content">
                <div class="order-items">
                  <div class="order-item">
                    <div class="order-item-image">
                      <img src="{% static 'core/img/rin/r13.png' %}" alt="Product" class="img-fluid">
                    </div>
                    <div class="order-item-details">
                      <h4>{{ renglon.razon_social }}</h4>
                      <p class="order-item-variant">{{ renglon.descripcion }}</p>
                      <div class="order-item-price">
                        <span class="quantity">{{ renglon.cantidad }} × ${{ renglon.precio }} = </span>
                        <span class="price">${{ renglon.total }}</span>
                      </div>
                    </div>
                  </div>
                  {% endif %}
                  {% endfor %}

                <div class="promo-code">
                  <div class="input-group">
<!--
                    <input type="text" class="form-control" placeholder="Promo Code" aria-label="Promo Code">
                    <button class="btn btn-outline-primary" type="button">Apply</button>
-->                    
                  </div>
                </div>

                <div class="order-totals">
                  <div class="order-subtotal d-flex justify-content-between">
                    <span>Subtotal</span>
                    <span>${{ carrito.subtotal }}</span>
                  </div>
<!--                  
                  <div class="order-shipping d-flex justify-content-between">
                    <span>Envío</span>
                    <span>$9.99</span>
                  </div>
-->                  
                  <div class="order-tax d-flex justify-content-between">
                    <span>I.V.A.</span>
                    <span>${{ carrito.iva_total }}</span>
                  </div>
                  <div class="order-total d-flex justify-content-between">
                    <span>Total</span>
                    <span>${{ carrito.total_general }}</span>
                  </div>
                </div>

                <div class="secure-checkout">
                  <div class="secure-checkout-header">
                    <i class="bi bi-shield-lock"></i>
                    <span>Secure Checkout</span>
                  </div>
                  <div class="payment-icons">
                    <i class="bi bi-credit-card-2-front"></i>
                    <i class="bi bi-credit-card"></i>
                    <i class="bi bi-paypal"></i>
                    <i class="bi bi-apple"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Terms and Privacy Modals -->
        <div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">Terms and Conditions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam in dui mauris. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim. Phasellus molestie magna non est bibendum non venenatis nisl tempor.</p>
                <p>Suspendisse in orci enim. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim. Phasellus molestie magna non est bibendum non venenatis nisl tempor.</p>
                <p>Suspendisse in orci enim. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim. Phasellus molestie magna non est bibendum non venenatis nisl tempor.</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">I Understand</button>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam in dui mauris. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim.</p>
                <p>Suspendisse in orci enim. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim. Phasellus molestie magna non est bibendum non venenatis nisl tempor.</p>
                <p>Suspendisse in orci enim. Vivamus hendrerit arcu sed erat molestie vehicula. Sed auctor neque eu tellus rhoncus ut eleifend nibh porttitor. Ut in nulla enim. Phasellus molestie magna non est bibendum non venenatis nisl tempor.</p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">I Understand</button>
              </div>
            </div>
          </div>
        </div>

      </div>

    </section><!-- /Checkout Section -->

  </main>


<script>
  // Renderizamos el botón oficial de PayPal, pero oculto
  paypal.Buttons({
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{ amount: { value: '0.01' } }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        console.log('Pago aprobado por ', details.payer.name.given_name);
      });
    }
  }).render('#paypal-button-container');
</script>
<script>
  document.getElementById("paypal-btn").addEventListener("click", function() {
    // Simulamos el click en el botón oficial de PayPal oculto
    document.querySelector("#paypal-button-container iframe")
      .contentWindow.document.querySelector("button").click();
  });
</script>
{% endblock %}